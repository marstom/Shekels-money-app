import datetime
from flask_login import UserMixin
from flask_migrate import Migrate
from flask_sqlalchemy import SQLAlchemy

from shekels.web import app

db = SQLAlchemy(app)

migrate = Migrate(app, db)

class User(db.Model, UserMixin):
    __tablename__ = 'user'

    id = db.Column(db.Integer, primary_key=True)
    login = db.Column(db.String)
    full_name = db.Column(db.String)
    password = db.Column(db.String)
    avatar = db.Column(db.String) #TODO obrazek BASE64

    def __str__(self):
        return "User: {} {}".format(self.login,
                                    self.full_name)

class Expense(db.Model):
    '''
    Each expense is related with user
    '''
    __tablename__ = 'expense'

    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String)
    price = db.Column(db.Integer)
    description = db.Column(db.String)
    date_time = db.Column(db.DateTime, default=datetime.datetime.utcnow)

    category_id = db.Column(db.Integer, db.ForeignKey('category.id'))

    user_id = db.Column(db.Integer, db.ForeignKey('user.id'))
    expense = db.relationship('User', backref='expenses')


class Category(db.Model):
    '''
    Category can have many expenses. one to many
    '''
    __tablename__ = 'category'

    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String)
    description = db.Column(db.String)

    expenses = db.relationship('Expense', backref='category')


class Report(db.Model):
    '''
    Table contains report generated by user
    '''
    __tablename__ = 'report'
    id = db.Column(db.Integer, primary_key=True)
    text = db.Column(db.String)


class PlanndeExpense(db.Model):
    __tablename__ = 'planned_expense'
    id = db.Column(db.Integer, primary_key=True)
    #TODO

